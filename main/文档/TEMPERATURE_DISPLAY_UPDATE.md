# æ¸©åº¦æ˜¾ç¤ºä½ç½®è°ƒæ•´è¯´æ˜

## ä¿®æ”¹å†…å®¹

å°† QMI8658 èŠ¯ç‰‡æ¸©åº¦æ˜¾ç¤ºä»**ç¯å¢ƒæ•°æ®å¡ç‰‡**ç§»è‡³**ç³»ç»Ÿç•Œé¢**ã€‚

## ä¿®æ”¹åŸå› 

### æ•°æ®åˆ†ç±»

**ç³»ç»Ÿæ•°æ®ï¼ˆåº•å±‚ç¡¬ä»¶ï¼‰ï¼š**
- âœ… WiFi çŠ¶æ€
- âœ… å›ºä»¶ç‰ˆæœ¬
- âœ… ç”µæ± ç”µå‹
- âœ… èŠ¯ç‰‡æ¸©åº¦ â† **æ–°å¢**

**ç¯å¢ƒæ•°æ®ï¼ˆå¤–éƒ¨ä¼ æ„Ÿå™¨ï¼‰ï¼š**
- ç¯å¢ƒæ¸©åº¦ï¼ˆéœ€å¤–éƒ¨ä¼ æ„Ÿå™¨ï¼‰
- ç¯å¢ƒæ¹¿åº¦ï¼ˆéœ€å¤–éƒ¨ä¼ æ„Ÿå™¨ï¼‰

### é€»è¾‘æ›´åˆç†

QMI8658 èŠ¯ç‰‡æ¸©åº¦æ˜¯**ç³»ç»Ÿå†…éƒ¨çŠ¶æ€**ï¼Œè€Œé**ç¯å¢ƒå‚æ•°**ï¼š
- èŠ¯ç‰‡æ¸©åº¦åæ˜ è®¾å¤‡å·¥ä½œçŠ¶æ€
- å¯ç”¨äºç›‘æ§ç³»ç»Ÿå¥åº·
- ä¸ç”µæ± ç”µå‹åŒå±ç³»ç»Ÿç›‘æ§æ•°æ®

## ç•Œé¢å˜åŒ–

### ä¿®æ”¹å‰

**Home æ ‡ç­¾ - ç¯å¢ƒå¡ç‰‡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¯å¢ƒ                     â”‚
â”‚ æ¸©åº¦ 28.5Â°C / æ¹¿åº¦ 0%   â”‚  â† åŒ…å«èŠ¯ç‰‡æ¸©åº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**System æ ‡ç­¾ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸçŠ¶æ€                 â”‚
â”‚ Wi-Fi: æœªè¿æ¥            â”‚
â”‚ å›ºä»¶: v1.0.0             â”‚
â”‚ ç”µæº: 4.15V              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®æ”¹å

**Home æ ‡ç­¾ - ç¯å¢ƒå¡ç‰‡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¯å¢ƒ                     â”‚
â”‚ æ¹¿åº¦ 0%                  â”‚  â† åªæ˜¾ç¤ºæ¹¿åº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**System æ ‡ç­¾ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸçŠ¶æ€                 â”‚
â”‚ Wi-Fi: æœªè¿æ¥            â”‚
â”‚ å›ºä»¶: v1.0.0             â”‚
â”‚ ç”µæº: 4.15V              â”‚
â”‚ æ¸©åº¦: 28.5Â°C (èŠ¯ç‰‡)     â”‚  â† **æ–°å¢èŠ¯ç‰‡æ¸©åº¦**
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä»£ç ä¿®æ”¹è¯¦æƒ…

### 1. æ·»åŠ æ ‡ç­¾å˜é‡

```c
static lv_obj_t *system_wifi_label;
static lv_obj_t *system_fw_label;
static lv_obj_t *system_power_label;
static lv_obj_t *system_temp_label;  /* ç³»ç»Ÿæ¸©åº¦æ ‡ç­¾ */ â† æ–°å¢
```

### 2. åˆ›å»ºæ¸©åº¦æ ‡ç­¾ï¼ˆç³»ç»Ÿé¢æ¿ï¼‰

```c
static void create_system_panel(lv_obj_t * parent)
{
    // ... å…¶ä»–ä»£ç  ...
    
    system_power_label = lv_label_create(panel);
    lv_obj_add_style(system_power_label, &style_muted, 0);
    lv_label_set_text(system_power_label, "ç”µæº: æš‚æ— æ•°æ®");

    // æ–°å¢æ¸©åº¦æ ‡ç­¾
    system_temp_label = lv_label_create(panel);
    lv_obj_add_style(system_temp_label, &style_muted, 0);
    lv_label_set_text(system_temp_label, "æ¸©åº¦: æš‚æ— æ•°æ®");
    
    // ... å…¶ä»–ä»£ç  ...
}
```

### 3. æ›´æ–°æ¸©åº¦æ˜¾ç¤ºé€»è¾‘

```c
static void refresh_all_ui_elements(void)
{
    char buf[128];
    
    /* å®æ—¶è·å–åº•å±‚ç³»ç»Ÿæ•°æ® */
    float current_voltage = BAT_Get_Volts();
    g_system_data.power_voltage = current_voltage;
    g_system_data.power_valid = 1;
    
    /* å®æ—¶è·å–èŠ¯ç‰‡æ¸©åº¦ */
    float chip_temp = getTemperature();
    
    // ... å…¶ä»–æ›´æ–°ä»£ç  ...
    
    /* æ›´æ–°ç³»ç»Ÿæ¸©åº¦æ ‡ç­¾ */
    if (system_temp_label) {
        if (chip_temp != 999) {
            snprintf(buf, sizeof(buf), "æ¸©åº¦: %.1fÂ°C (èŠ¯ç‰‡)", chip_temp);
            lv_label_set_text(system_temp_label, buf);
        } else {
            lv_label_set_text(system_temp_label, "æ¸©åº¦: æš‚æ— æ•°æ®");
        }
    }
}
```

### 4. ä¿®æ”¹ç¯å¢ƒå¡ç‰‡æ˜¾ç¤º

```c
/* æ›´æ–°ç¯å¢ƒæ•°æ® - åªæ˜¾ç¤ºæ¹¿åº¦ */
const smart_ui_env_data_t *env_data = smart_ui_get_env_data();
if (env_value_label) {
    if (env_data && env_data->is_valid) {
        snprintf(buf, sizeof(buf), "æ¹¿åº¦ %u%%", env_data->humidity);
        lv_label_set_text(env_value_label, buf);
    } else {
        lv_label_set_text(env_value_label, "æš‚æ— æ•°æ®");
    }
}
```

## æ•°æ®æ›´æ–°æµç¨‹

### æ¸©åº¦æ•°æ®æµ

```
å®šæ—¶å™¨ï¼ˆæ¯ 500msï¼‰
    â†“
refresh_all_ui_elements()
    â†“
getTemperature() â†’ è¯»å– QMI8658
    â†“
chip_temp = 28.5Â°C
    â†“
æ›´æ–° system_temp_label
    â†“
æ˜¾ç¤ºï¼šæ¸©åº¦: 28.5Â°C (èŠ¯ç‰‡)
```

### ç‰¹ç‚¹

- âœ… **è‡ªåŠ¨æ›´æ–°** - æ¯ 500ms åˆ·æ–°
- âœ… **å®æ—¶è¯»å–** - ç›´æ¥ä»ç¡¬ä»¶è·å–
- âœ… **é”™è¯¯å¤„ç†** - 999 è¡¨ç¤ºè¯»å–å¤±è´¥
- âœ… **æ¸…æ™°æ ‡æ³¨** - æ˜¾ç¤º"(èŠ¯ç‰‡)"é¿å…è¯¯è§£

## ä¸ºä»€ä¹ˆæ ‡æ³¨"(èŠ¯ç‰‡)"

### é¿å…æ··æ·†

```
æ¸©åº¦: 28.5Â°C        â† å®¹æ˜“è¯¯è§£ä¸ºç¯å¢ƒæ¸©åº¦
æ¸©åº¦: 28.5Â°C (èŠ¯ç‰‡) â† æ˜ç¡®æ˜¯èŠ¯ç‰‡å†…éƒ¨æ¸©åº¦
```

### æ¸©åº¦å·®å¼‚è¯´æ˜

```
ç¯å¢ƒæ¸©åº¦: 20Â°C
èŠ¯ç‰‡æ¸©åº¦: 28Â°C  â† é«˜å‡º 8Â°Cï¼ˆæ­£å¸¸å·¥ä½œå‘çƒ­ï¼‰
```

**å…¸å‹åå·®ï¼š**
- å¾…æœºçŠ¶æ€ï¼š+5Â°C ~ +10Â°C
- å·¥ä½œçŠ¶æ€ï¼š+10Â°C ~ +15Â°C
- é«˜è´Ÿè½½ï¼š+15Â°C ~ +20Â°C

## æ‰©å±•ï¼šæ·»åŠ å¤–éƒ¨æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨

å¦‚æœæ‚¨åç»­æ·»åŠ äº†å¤–éƒ¨æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ï¼ˆDHT22ã€SHT30ç­‰ï¼‰ï¼š

### æ–¹æ¡ˆ1ï¼šç¯å¢ƒå¡ç‰‡æ˜¾ç¤ºå¤–éƒ¨ä¼ æ„Ÿå™¨æ•°æ®

```c
void temperature_sensor_task(void *pvParameters)
{
    while(1) {
        // è¯»å–å¤–éƒ¨ä¼ æ„Ÿå™¨
        float ambient_temp = read_dht22_temperature();
        uint8_t humidity = read_dht22_humidity();
        
        // æ›´æ–°ç¯å¢ƒå¡ç‰‡ï¼ˆä¼šæ˜¾ç¤ºçœŸå®ç¯å¢ƒæ¸©æ¹¿åº¦ï¼‰
        ui_update_environment(ambient_temp, humidity);
        
        vTaskDelay(pdMS_TO_TICKS(5000));
    }
}
```

**æ˜¾ç¤ºæ•ˆæœï¼š**
```
Home æ ‡ç­¾ - ç¯å¢ƒå¡ç‰‡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¯å¢ƒ                     â”‚
â”‚ æ¸©åº¦ 20.5Â°C / æ¹¿åº¦ 60%  â”‚ â† å¤–éƒ¨ä¼ æ„Ÿå™¨æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

System æ ‡ç­¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸçŠ¶æ€                 â”‚
â”‚ æ¸©åº¦: 28.5Â°C (èŠ¯ç‰‡)     â”‚ â† å†…éƒ¨èŠ¯ç‰‡æ¸©åº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–¹æ¡ˆ2ï¼šåŒæ—¶æ˜¾ç¤ºä¸¤ç§æ¸©åº¦

ä¿®æ”¹ç¯å¢ƒå¡ç‰‡æ ¼å¼ï¼š

```c
if (env_data && env_data->is_valid) {
    snprintf(buf, sizeof(buf), 
             "ç¯å¢ƒ %.1fÂ°C / æ¹¿åº¦ %u%%", 
             env_data->temperature, env_data->humidity);
    lv_label_set_text(env_value_label, buf);
}
```

**æ˜¾ç¤ºæ•ˆæœï¼š**
```
Home æ ‡ç­¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¯å¢ƒ                     â”‚
â”‚ ç¯å¢ƒ 20.5Â°C / æ¹¿åº¦ 60%  â”‚ â† ç¯å¢ƒæ¸©æ¹¿åº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

System æ ‡ç­¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸçŠ¶æ€                 â”‚
â”‚ æ¸©åº¦: 28.5Â°C (èŠ¯ç‰‡)     â”‚ â† èŠ¯ç‰‡æ¸©åº¦
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å½“å‰çŠ¶æ€æ€»ç»“

### ç¯å¢ƒå¡ç‰‡ï¼ˆHome æ ‡ç­¾ï¼‰

| å­—æ®µ | æ•°æ®æº | æ›´æ–°æ–¹å¼ |
|-----|-------|---------|
| **æ¹¿åº¦** | `g_env_data.humidity` | åº”ç”¨å±‚è°ƒç”¨ `ui_update_environment()` |

**ç”¨é€”ï¼š** 
- æ˜¾ç¤ºå¤–éƒ¨ä¼ æ„Ÿå™¨çš„ç¯å¢ƒæ¹¿åº¦
- å¦‚æœæ·»åŠ å¤–éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ï¼Œä¹Ÿä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºç¯å¢ƒæ¸©åº¦

### ç³»ç»Ÿç•Œé¢ï¼ˆSystem æ ‡ç­¾ï¼‰

| å­—æ®µ | æ•°æ®æº | æ›´æ–°æ–¹å¼ |
|-----|-------|---------|
| **Wi-Fi** | `g_system_data.wifi_status` | åº”ç”¨å±‚æ›´æ–° |
| **å›ºä»¶** | `g_system_data.firmware_version` | åº”ç”¨å±‚æ›´æ–° |
| **ç”µæº** | `BAT_Get_Volts()` | å®šæ—¶å™¨è‡ªåŠ¨è·å– |
| **æ¸©åº¦** | `getTemperature()` | å®šæ—¶å™¨è‡ªåŠ¨è·å– â† **æ–°å¢** |

**ç”¨é€”ï¼š**
- ç›‘æ§ç³»ç»Ÿå†…éƒ¨çŠ¶æ€
- æ£€æµ‹è®¾å¤‡å¥åº·
- è°ƒè¯•ç³»ç»Ÿé—®é¢˜

## ä¼˜åŠ¿æ€»ç»“

### 1. æ•°æ®åˆ†ç±»æ¸…æ™°

- **ç³»ç»Ÿç•Œé¢** - è®¾å¤‡å†…éƒ¨çŠ¶æ€
- **ç¯å¢ƒå¡ç‰‡** - å¤–éƒ¨ç¯å¢ƒå‚æ•°

### 2. é¿å…è¯¯è§£

- æ˜ç¡®æ ‡æ³¨"(èŠ¯ç‰‡)"
- ç”¨æˆ·çŸ¥é“è¿™ä¸æ˜¯ç¯å¢ƒæ¸©åº¦

### 3. ä¾¿äºæ‰©å±•

- ç¯å¢ƒå¡ç‰‡é¢„ç•™ç»™å¤–éƒ¨ä¼ æ„Ÿå™¨
- ç³»ç»Ÿç•Œé¢åŒ…å«æ‰€æœ‰å†…éƒ¨ç›‘æ§

### 4. æ¶æ„ä¸€è‡´

- èŠ¯ç‰‡æ¸©åº¦ ä¸ ç”µæ± ç”µå‹ åŒå±ç³»ç»Ÿç›‘æ§
- éƒ½åœ¨å®šæ—¶å™¨ä¸­è‡ªåŠ¨è·å–
- éƒ½æ˜¾ç¤ºåœ¨ç³»ç»Ÿç•Œé¢

## æµ‹è¯•å»ºè®®

### 1. éªŒè¯æ¸©åº¦æ˜¾ç¤º

- åˆ‡æ¢åˆ° System æ ‡ç­¾
- æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºï¼š`æ¸©åº¦: XX.XÂ°C (èŠ¯ç‰‡)`

### 2. éªŒè¯è‡ªåŠ¨æ›´æ–°

- è§‚å¯Ÿæ¸©åº¦å€¼æ˜¯å¦æ¯ 500ms æ›´æ–°
- è§¦æ‘¸å±å¹•ç­‰æ“ä½œï¼Œçœ‹æ¸©åº¦æ˜¯å¦ä¸Šå‡

### 3. éªŒè¯ç¯å¢ƒå¡ç‰‡

- åˆ‡æ¢åˆ° Home æ ‡ç­¾
- æ£€æŸ¥ç¯å¢ƒå¡ç‰‡åªæ˜¾ç¤ºï¼š`æ¹¿åº¦ 0%`

## æœªæ¥æ”¹è¿›

### æ·»åŠ æ¸©åº¦è¶‹åŠ¿

```c
// è®°å½•æ¸©åº¦å†å²ï¼Œæ˜¾ç¤ºå˜åŒ–è¶‹åŠ¿
static float temp_history[60];  // æœ€è¿‘ 30 ç§’
static uint8_t temp_index = 0;

void update_temperature_trend(void)
{
    temp_history[temp_index] = getTemperature();
    temp_index = (temp_index + 1) % 60;
    
    // è®¡ç®—è¶‹åŠ¿ï¼šä¸Šå‡/ä¸‹é™/ç¨³å®š
    float trend = calculate_trend(temp_history, 60);
    
    if (trend > 0.5f) {
        snprintf(buf, sizeof(buf), "æ¸©åº¦: %.1fÂ°C â†‘", chip_temp);
    } else if (trend < -0.5f) {
        snprintf(buf, sizeof(buf), "æ¸©åº¦: %.1fÂ°C â†“", chip_temp);
    } else {
        snprintf(buf, sizeof(buf), "æ¸©åº¦: %.1fÂ°C â†’", chip_temp);
    }
}
```

### æ·»åŠ è¿‡çƒ­è­¦å‘Š

```c
void check_temperature_warning(float temp)
{
    if (temp > 70.0f) {
        lv_obj_set_style_text_color(system_temp_label, 
                                     lv_color_hex(0xFF0000), 0);
        snprintf(buf, sizeof(buf), "âš ï¸ æ¸©åº¦: %.1fÂ°C (è¿‡çƒ­)", temp);
    } else if (temp > 60.0f) {
        lv_obj_set_style_text_color(system_temp_label, 
                                     lv_color_hex(0xFFA500), 0);
        snprintf(buf, sizeof(buf), "æ¸©åº¦: %.1fÂ°C (åé«˜)", temp);
    } else {
        lv_obj_set_style_text_color(system_temp_label, 
                                     lv_color_hex(0x6F7782), 0);
        snprintf(buf, sizeof(buf), "æ¸©åº¦: %.1fÂ°C (æ­£å¸¸)", temp);
    }
}
```

ç°åœ¨æ¸©åº¦æ˜¾ç¤ºå·²ç»ç§»åˆ°ç³»ç»Ÿç•Œé¢ï¼Œåˆ†ç±»æ›´åŠ åˆç†ï¼ğŸ‰
